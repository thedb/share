
跨域的解决方案
=======

>**目录**
>
>-1. 什么是跨域
>
>-2. 前端解决方案
>
>-3. 后端解决方案

## **1.什么是跨域**

> A cross-domain solution (CDS) is a means of information assurance that provides the ability to manually or automatically access or transfer between two or more differing security domains.

上面是从wiki上引用过来的。意思是：解决两个安全域之间的信息传递，这个就叫做CDS——跨域解决方案。

笼统来说：

**跨域是指一个域下的文档或脚本试图去请求另一个域下的资源**
--------

### **广义跨域**

> 资源跳转： 重定向、表单提交
>
> 资源嵌入： ```<link>```、```<script>```、```<img>```、```<iframe>```等dom标签，还有样式中```background:url()```、```@font-face()```等文件外链
>
> 脚本请求： js发起的ajax请求、dom和js对象的跨域操作等

### **狭义跨域**

> 在浏览器**同源策略**限制下的不同域内的资源请求

<a href="https://github.com/thedb/share/blob/master/JSON%26JSONP.md">了解更多同源策略</a>

> 再看下面的几个示例来复习一下同源的概念：
>
<table>
<thead>
<tr><th>URL1</th><th>URL2</th><th>说明</th><th>是否允许通信</th></tr>
</thead>
<tbody>
<tr>
<td><a href="http://www.foo.com/js/a.js" target="_blank">http://www.foo.com/js/a.js</a></td>
<td><a href="http://www.foo.com/js/b.js" target="_blank">http://www.foo.com/js/b.js</a></td>
<td>协议、域名、端口都相同</td>
<td>允许</td>
</tr>
<tr>
<td><a href="http://www.foo.com/js/a.js" target="_blank">http://www.foo.com/js/a.js</a></td>
<td><a href="http://www.foo.com:8888/js/b.js" target="_blank">http://www.foo.com:8888/js/b.js</a></td>
<td>协议、域名相同，端口不同</td>
<td>不允许</td>
</tr>
<tr>
<td><a href="https://www.foo.com/js/a.js" target="_blank">https://www.foo.com/js/a.js</a></td>
<td><a href="http://www.foo.com/js/b.js" target="_blank">http://www.foo.com/js/b.js</a></td>
<td>主机、域名相同，协议不同</td>
<td>不允许</td>
</tr>
<tr>
<td><a href="http://www.foo.com/js/a.js" target="_blank">http://www.foo.com/js/a.js</a></td>
<td><a href="http://www.bar.com/js/b.js" target="_blank">http://www.bar.com/js/b.js</a></td>
<td>协议、端口相同，域名不同</td>
<td>不允许</td>
</tr>
<tr>
<td><a href="http://www.foo.com/js/a.js" target="_blank">http://www.foo.com/js/a.js</a></td>
<td><a href="http://foo.com/js/b.js" target="_blank">http://foo.com/js/b.js</a></td>
<td>协议、端口相同，主域名相同，子域名不同</td>
<td>不允许</td>
</tr>
</tbody>
</table>

### **同源策略限制以下几种行为：**

> Cookie、LocalStorage 和 IndexDB 无法读取
>
> DOM 和 Js对象无法获得
>
> AJAX 请求不能发送

## **2.前端解决方案**

### **2.1 JSONP（JSON with Padding）**

浏览器的```同源策略```限制了客户端跨域请求其他域的可能性，唯独在html页面中通过相应的标签从不同域名下加载静态资源文件是被浏览器允许的，所以JSONP是绕过了```同源策略```来“解决”跨域问题。

**原生实现**

```

<script>
  function jsonp () {
    let script = document.createElement('script');
    script.type = 'text/javascript';
    // script.src = 'your adress';
    script.src = 'http://192.168.2.128:3000/api/jsonp?cb=doSomething&name=nurun';
    document.head.appendChild(script);
  }
  function doSomething(res) {
    console.log(res.result);
  }
</script>

```
